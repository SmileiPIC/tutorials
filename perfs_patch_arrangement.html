
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Patch arrangement &#8212; Smilei tutorials  unknown documentation</title>
    <link rel="stylesheet" href="_static/smilei_theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="_static/smileiIcon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Advanced" href="advanced.html" />
    <link rel="prev" title="Parallel computing" href="perfs_parallel_computing.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": {
      scale: 95,
      availableFonts: ["TeX"]
    }
  });
  </script>
   
  </head><body>

<div id="smallScreenMenu" class="off">

    
    <div class="toctree-smilei">
        <ul>
                <li class="outer">
                    <a href="basics_setup.html">Setup</a>
                </li>
                <li class="outer">
                    <a href="basics_laser_vacuum.html">Laser Propagation in vacuum</a>
                </li>
                <li class="outer">
                    <a href="basics_thermal_plasma.html">Thermal plasma</a>
                </li>
                <li class="outer">
                    <a href="basics_weibel_twostream.html">Weibel and two-stream instabilities</a>
                </li>
                <li class="outer">
                    <a href="basics_units.html">Units</a>
                </li>
        </ul>
        <hr />
        <ul>
                <li class="outer">
                    <a href="perfs_parallel_computing.html">Parallel computing</a>
                </li>
        </ul>
                <ul>
<li><a class="reference internal" href="#">Patch arrangement</a><ul>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#setting-up-the-simulation">Setting up the simulation</a></li>
<li><a class="reference internal" href="#change-the-patch-arrangement">Change the patch arrangement</a></li>
<li><a class="reference internal" href="#tuning-the-patch-arrangement">Tuning the patch arrangement</a></li>
</ul>
</li>
</ul>

        <ul id="smallScreenMenuAfterTOC">
        </ul>
        <hr />
        <ul>
                <li class="outer">
                    <a href="advanced_field_ionization.html">Field ionization</a>
                </li>
                <li class="outer">
                    <a href="advanced_collisions.html">Binary collisions and impact ionization</a>
                </li>
                <li class="outer">
                    <a href="advanced_radiation_reaction.html">Synchrotron-like radiation reaction</a>
                </li>
                <li class="outer">
                    <a href="advanced_breit_wheeler.html">Multiphoton Breit-Wheeler pair creation process</a>
                </li>
                <li class="outer">
                    <a href="advanced_wakefield.html">2D laser wakefield acceleration</a>
                </li>
                <li class="outer">
                    <a href="advanced_wakefield_AMcylindrical.html">Azimuthal-mode-decomposition cylindrical geometry</a>
                </li>
                <li class="outer">
                    <a href="advanced_wakefield_electron_beam.html">Field initialization for a relativistic electron bunch</a>
                </li>
                <li class="outer">
                    <a href="advanced_wakefield_envelope.html">Envelope model for laser wakefield acceleration</a>
                </li>
                <li class="outer">
                    <a href="advanced_vtk.html">Export to VTK and 3D visualization</a>
                </li>
        </ul>
        <hr />
    </div>

</div>
<div id="hcontainer">
    <div id="nav_positioner">
        <div id="nav">
            <div id="nav_button" onclick="toggleNav()">
                Sections
            </div>
            <div id="nav_list" class="toctree-smilei">
                <div id="nav_title"><a href="#">Patch arrangement</a></div>
                <ul>
<li><a class="reference internal" href="#">Patch arrangement</a><ul>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#setting-up-the-simulation">Setting up the simulation</a></li>
<li><a class="reference internal" href="#change-the-patch-arrangement">Change the patch arrangement</a></li>
<li><a class="reference internal" href="#tuning-the-patch-arrangement">Tuning the patch arrangement</a></li>
</ul>
</li>
</ul>

            </div>
        </div>
    </div>
    
    <div class="headercolor">
    </div>
    <div class="hpositioner">
        <div class="header">
        <div class="logo">
            <a href="index.html">
                <img class="logo" src="_static/smileiLogo_tutorials.svg" alt="Logo" />
            </a>
        </div>
        <div class="menu"
            id="menu_PIC basics"
            
        >
            <div id="menuButton_PIC basics" class="menuButton"
                 onmouseenter="prepareMenu('menu_PIC basics')"
                 onmousedown="event.preventDefault()"
            >
                <a href="basics.html">
                    <span>PIC basics</span>
                </a>
            </div>
            <div class="off" onmouseleave="leaveMenu('menu_PIC basics',this)">
                <div class="toctree-smilei">
                    <ul>
                        <li class="outer">
                            <a href="basics_setup.html">Setup</a>
                        </li>
                        <li class="outer">
                            <a href="basics_laser_vacuum.html">Laser Propagation in vacuum</a>
                        </li>
                        <li class="outer">
                            <a href="basics_thermal_plasma.html">Thermal plasma</a>
                        </li>
                        <li class="outer">
                            <a href="basics_weibel_twostream.html">Weibel and two-stream instabilities</a>
                        </li>
                        <li class="outer">
                            <a href="basics_units.html">Units</a>
                        </li>
        
                    </ul>
                </div>
            </div>
        </div>
        <div class="menu"
            id="menu_Performances"
            style="font-weight:bold"
        >
            <div id="menuButton_Performances" class="menuButton"
                 onmouseenter="prepareMenu('menu_Performances')"
                 onmousedown="event.preventDefault()"
            >
                <a href="perfs.html">
                    <span>Performances</span>
                </a>
            </div>
            <div class="off" onmouseleave="leaveMenu('menu_Performances',this)">
                <div class="toctree-smilei">
                    <ul>
                        <li class="outer">
                            <a href="perfs_parallel_computing.html">Parallel computing</a>
                        </li>
                        <li >
                            <a href="#">Patch arrangement</a>
                        </li>
        
                    </ul>
                </div>
            </div>
        </div>
        <div class="last menu"
            id="menu_Advanced"
            
        >
            <div id="menuButton_Advanced" class="menuButton"
                 onmouseenter="prepareMenu('menu_Advanced')"
                 onmousedown="event.preventDefault()"
            >
                <a href="advanced.html">
                    <span>Advanced</span>
                </a>
            </div>
            <div class="off" onmouseleave="leaveMenu('menu_Advanced',this)">
                <div class="toctree-smilei">
                    <ul>
                        <li class="outer">
                            <a href="advanced_field_ionization.html">Field ionization</a>
                        </li>
                        <li class="outer">
                            <a href="advanced_collisions.html">Binary collisions and impact ionization</a>
                        </li>
                        <li class="outer">
                            <a href="advanced_radiation_reaction.html">Synchrotron-like radiation reaction</a>
                        </li>
                        <li class="outer">
                            <a href="advanced_breit_wheeler.html">Multiphoton Breit-Wheeler pair creation process</a>
                        </li>
                        <li class="outer">
                            <a href="advanced_wakefield.html">2D laser wakefield acceleration</a>
                        </li>
                        <li class="outer">
                            <a href="advanced_wakefield_AMcylindrical.html">Azimuthal-mode-decomposition cylindrical geometry</a>
                        </li>
                        <li class="outer">
                            <a href="advanced_wakefield_electron_beam.html">Field initialization for a relativistic electron bunch</a>
                        </li>
                        <li class="outer">
                            <a href="advanced_wakefield_envelope.html">Envelope model for laser wakefield acceleration</a>
                        </li>
                        <li class="outer">
                            <a href="advanced_vtk.html">Export to VTK and 3D visualization</a>
                        </li>
        
                    </ul>
                </div>
            </div>
        </div>
        
        <script type="text/javascript">
            var es=document.getElementsByClassName("menuButton"), i=0;
            var evt = "ontouchend" in document ? "touchend" : "click";
            for( var i=0; i<es.length; i+=1 ) {
                es[i].addEventListener(evt, function(a){ return function(){toggleMenu(a)};}(es[i].parentNode.id));
            }
        </script>
        
        <div id="searchbox" role="search" style="display:none">
            <form class="search" action="search.html" method="get">
              <input type="text" name="q" placeholder="Search" id="searchinput" />
              <input type="hidden" name="check_keywords" value="yes" />
              <input type="hidden" name="area" value="default" />
            </form>
        </div>
        
        <div id="searchicon" onclick="openSearch()" style="display:block">
            <svg
               xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 80 120">
              <g transform="translate(0,-932.36216)" >
                <circle
                   r="25" cy="977.51044" cx="38.078663"
                   style="opacity:1;fill:none;stroke:#ffffff;stroke:var(--header_text);stroke-width:10;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
                <rect
                   transform="matrix(0.36717877,0.93015039,-0.93427297,0.35655858,0,0)"
                   rx="4.9996676" ry="7.4995141" x="947.6142" y="316.16959"
                   height="14.117695" width="46.476151"
                   style="opacity:1;fill:#ffffff;fill:var(--header_text);fill-opacity:1;stroke:none;" />
                <path
                   d="m 41.383282,962.25996 a 15,15 0 0 1 11.660107,11.6355"
                   style="opacity:1;fill:none;stroke:#ffffff;stroke:var(--header_text);stroke-width:3;stroke-linecap:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
              </g>
            </svg>
        </div>
        <div id="closesearchicon" onclick="closeSearch()" style="display:none">
            <svg
               xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 80 120">
              <g
                 transform="translate(0,-932.36216)"
                 style="fill:none;stroke:#ffffff;stroke:var(--header_text);stroke-width:10;stroke-linecap:round;stroke-linejoin:miter;stroke-opacity:1;stroke-miterlimit:4;stroke-dasharray:none">
                <path d="m 10,962.36216 60,60.00004" />
                <path d="M 70,962.36216 10,1022.3622" />
              </g>
            </svg>
        </div>
        
        <div id="smallScreenMenuButton" onclick="event.preventDefault(); toggleSmallScreenMenu(event)">
            <svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg"
               viewBox="-20 -20 140 140">
              <g  style="fill:#ffffff; fill:var(--header_text);stroke:none;">
                <circle cx="15" cy="20" r="5" />
                <circle cx="35" cy="20" r="5" />
                <circle cx="85" cy="20" r="5" />
                <rect width="50" height="10" x="35" y="15" rx="0" ry="0" />
                <circle cx="15" cy="40" r="5" />
                <circle cx="35" cy="40" r="5" />
                <circle cx="85" cy="40" r="5" />
                <rect width="50" height="10" x="35" y="35" rx="0" ry="0" />
                <circle cx="15" cy="60" r="5" />
                <circle cx="35" cy="60" r="5" />
                <circle cx="85" cy="60" r="5" />
                <rect width="50" height="10" x="35" y="55" rx="0" ry="0" />
                <circle cx="15" cy="80" r="5" />
                <circle cx="35" cy="80" r="5" />
                <circle cx="85" cy="80" r="5" />
                <rect width="50" height="10" x="35" y="75" rx="0" ry="0" />
              </g>
            </svg>
        </div>
        
    </div>
    
</div>
</div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="patch-arrangement">
<h1>Patch arrangement<a class="headerlink" href="#patch-arrangement" title="Permalink to this headline">¶</a></h1>
<p>In some situations with slow particles dynamics, the dynamic load balancing
may not be relevant to speed-up the simulation.
Moreover, as it relies on a
<a class="reference external" href="https://smileipic.github.io/Smilei/Understand/parallelization.html#load-balancing-between-mpi-regions">Hilbert curve</a>,
it may not be able to split intelligently the plasma in equal parts.</p>
<p>Typically, this happens when the plasma is contained in a thin slab.
The Hilbert curve splitting is better replaced by a simple <em>linearized</em> splitting
that divides the box in slabs of equal size.</p>
<p>The goal of this tutorial is to learn about these various arrangements of patches,
and test them in realistic cases.</p>
<p>We recommand first to run the <a class="reference external" href="https://smileipic.github.io/tutorials/perfs_parallel_computing.html">parallel computing</a> tutorial.</p>
<hr class="docutils" />
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>Starting case :</dt><dd><p><a class="reference external" href="radiation_pressure_acc_hilbert.py">radiation_pressure_acc_hilbert.py</a></p>
</dd>
</dl>
<p>To highlight the phenomenon and to simplify the discussion
we propose to run on several MPI processes and only 1 thread per process.</p>
</div>
<hr class="docutils" />
<div class="section" id="setting-up-the-simulation">
<h2>Setting up the simulation<a class="headerlink" href="#setting-up-the-simulation" title="Permalink to this headline">¶</a></h2>
<p>Set your simulation with 16 MPI processes, and only 1 thread per process. Typically:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span>
mpirun -np <span class="m">16</span> smilei radiation_pressure_acc_hilbert.py
</pre></div>
</div>
<p>Observe timers and the probe diagnostics results.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Field diagnostics do not work with the alternative <code class="docutils literal notranslate"><span class="pre">patch_arrangement</span></code>
so we use Probe diagnostics instead.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="change-the-patch-arrangement">
<h2>Change the patch arrangement<a class="headerlink" href="#change-the-patch-arrangement" title="Permalink to this headline">¶</a></h2>
<p>Activate the dynamic load balancing to absorb synchronizations overhead</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">LoadBalancing</span><span class="p">(</span>
    <span class="n">every</span> <span class="o">=</span> <span class="mi">20</span>
<span class="p">)</span>
</pre></div>
</div>
<p>A look at the plasma shape shows that, at initialization,
the plasma is located within a thin slab along the Y axis.
Then, it is pushed along the X axis.
We propose to enforce an arrangement of patches that splits
the plasma into slabs along X, so that each region owns an
equal share of the computational load.
You may add the following line in the bloc <code class="docutils literal notranslate"><span class="pre">Main()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">patch_arrangement</span> <span class="o">=</span> <span class="s2">&quot;linearized_YX&quot;</span><span class="p">,</span>
</pre></div>
</div>
<p>We can imagine that splitting into slabs along Y would be a
terrible option, because all the plasma will be contained in
one process only. All other processes will need to wait and do nothing.
You can still try it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">patch_arrangement</span> <span class="o">=</span> <span class="s2">&quot;linearized_XY&quot;</span><span class="p">,</span>
</pre></div>
</div>
<p>You may want to stop the simulation before the end!</p>
<div class="figure align-default" id="id1">
<img alt="_images/arrangement.png" src="_images/arrangement.png" />
<p class="caption"><span class="caption-number">Fig. 1 </span><span class="caption-text">Each numbered square represents a patch in an 8 x 8 patches configuration.
Each color represents one of the 16 MPI processes.
In this test case, the plasma is located in the 2nd column of the box.
You can observe how the dynamic load balancing (dlb) makes a coarse splitting
where there is no plasma.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="tuning-the-patch-arrangement">
<h2>Tuning the patch arrangement<a class="headerlink" href="#tuning-the-patch-arrangement" title="Permalink to this headline">¶</a></h2>
<p>In the situation above, there was a maximum of 8 patches in the Y direction,
so that the plasma could not be split in more than 8 pieces.
We would like to split it in 16 pieces to make sure that each
of the 16 processes has something to work on.
Unfortunatly the patch size, 75 x 125 cells, does not permit to split more in Y.</p>
<p>Study the following code, which slightly increases the spatial
resolution in Y to get a number of cells in Y divisible per 16.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">current_ncells_Y</span> <span class="o">=</span> <span class="n">Lsim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">l0</span><span class="o">/</span><span class="n">resx</span><span class="p">)</span>
<span class="n">target_ncells_Y</span> <span class="o">=</span> <span class="mf">1024.</span>
<span class="n">target_cell_length_Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">l0</span><span class="o">/</span><span class="n">resx</span><span class="o">*</span><span class="n">current_ncells_Y</span><span class="p">)</span><span class="o">/</span><span class="n">target_ncells_Y</span>

<span class="n">Main</span><span class="p">(</span>
    <span class="n">cell_length</span> <span class="o">=</span> <span class="p">[</span><span class="n">l0</span><span class="o">/</span><span class="n">resx</span><span class="p">,</span><span class="n">target_cell_length_Y</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>It is available in the input file
<a class="reference external" href="radiation_pressure_acc_linearized.py">radiation_pressure_acc_linearized.py</a>.</p>
<p>Run again the <code class="docutils literal notranslate"><span class="pre">linearized_YX</span></code> configuration: the higher resolution
leads to more particles, thus a slightly higher computation time.</p>
<p>You can now run the simulation with the 8 x 16 patches:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">number_of_patches</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span> <span class="p">],</span>
</pre></div>
</div>
<p>For a fair comparison, use this configuration with the <code class="docutils literal notranslate"><span class="pre">hilbertian</span></code>
arrangement (the default value of <code class="docutils literal notranslate"><span class="pre">patch_arrangement</span></code>).
In this mode, when the number of patches is not the same along all directions,
the Hilbert pattern is replicated in the larger direction (Y here).
This can be beneficial here.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The paramater <code class="docutils literal notranslate"><span class="pre">number_of_patches</span></code> must be a power of 2
with the <code class="docutils literal notranslate"><span class="pre">hilbertian</span></code> arrangement. This is not required with the
<code class="docutils literal notranslate"><span class="pre">linearized</span></code> arrangement.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      <div>
        <input type="button" id="themebutton"  value="" onclick="switchTheme('')" />
      </div>
      <div>
      <a href="site.html">Site index</a>
      </div>
      <div>
        Last updated on Mar 12, 2025
      </div>
      
      <div>
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      </div>
      
    </div>
    
    <script type="text/javascript">
        
        var nav = document.getElementById("nav");
        var nav_list = document.getElementById("nav_list");
        var nav_button = document.getElementById("nav_button");
        var smallScreenMenu = document.getElementById("smallScreenMenu");
        var smallScreenMenuButton = document.getElementById("smallScreenMenuButton");
        var searchicon = document.getElementById("searchicon");
        var searchbox  = document.getElementById("searchbox");
        var searchinput= document.getElementById("searchinput");
        var menus = document.getElementsByClassName("menu");
        for( var i=0; i<menus.length; i++ )
            menus[i].active = false;
        
        // Manage theme
        var theme="light";
        function switchTheme(type) {
            if( type == "dark" || ( ! type && theme == "light" ) ) {
                theme = "dark";
                document.documentElement.setAttribute('theme', 'dark');
                window.name = "dark_theme"
                localStorage.setItem("_theme","dark")
            } else {
                theme = "light";
                document.documentElement.setAttribute('theme', 'light');
                window.name = "light_theme"
                localStorage.setItem("_theme","light")
            }
        }
        if( window.name && window.name == "light_theme" ) {
            switchTheme("light");
        } else if ( window.name && window.name == "dark_theme" ) {
            switchTheme("dark");
        } else if( stored_theme = localStorage.getItem("_theme") ) {
            switchTheme(stored_theme);
        } else if( window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) {
            switchTheme("dark");
        }
        
        var ul = nav_list.getElementsByTagName("ul")[0], li;
        var keep_nav = false;
        if( ul ) {
            li = ul.firstElementChild;
            if( li ) {
                if( li.getElementsByTagName("ul").length > 0 ) keep_nav = true;
            }
        }
        if( keep_nav ) {
            li.removeChild( li.firstElementChild );
        } else {
            document.getElementById("nav_positioner").removeChild( document.getElementById("nav") );
        }
        
        function navOff() {
            nav_list.style.display = "none";
            nav_button.className = "";
            nav.style.overflowY = "visible";
        }
        
        function toggleNav() {
            for( var i=0; i<menus.length; i++ )
                menuOff( menus[i] );
            if( nav_list.style.display != "inline-block" ) {
                nav_list.style.display = "inline-block";
                nav_button.className = "pushed";
                nav.style.overflowY = "auto";
            } else {
                navOff();
            }
        }
        
        function toggleSmallScreenMenu(e) {
            if( smallScreenMenu.className != "on" ) {
                smallScreenMenu.className = "on";
                smallScreenMenuButton.className = "pushed";
                document.documentElement.style.overflow = "hidden";
            } else {
                smallScreenMenu.className = "off";
                smallScreenMenuButton.className = "";
                document.documentElement.style.overflow = "";
            }
        }
        
        if (smallScreenMenuAfterTOC = document.getElementById("smallScreenMenuAfterTOC")) {
            var smallScreenMenuTOC = smallScreenMenuAfterTOC.previousElementSibling
                .getElementsByTagName("li")[0].getElementsByTagName("ul")[0].getElementsByTagName("li");
            for (var i = 0; i < smallScreenMenuTOC.length; i++) {
                if (smallScreenMenuTOC[i].tagName = "a") {
                    smallScreenMenuTOC[i].addEventListener("click", function(event){ toggleSmallScreenMenu(event); } );
                }
            }
        }
        
        function prepareMenu(menu_id) {
            var menu = document.getElementById(menu_id);
            menu.timer1 = setTimeout(function(a){ return function(){thisMenuOnly(a)};}(menu_id), 100);
            menu.addEventListener("mouseleave", function(a){ return function(){clearTimeout(a.timer1)};}(menu) );
        }
        
        function leaveMenu(menu_id, source) {
            var menu = document.getElementById(menu_id);
            menu.timer2 = setTimeout(function(a){ return function(){menuOff(a)};}(menu), 1000);
            source.addEventListener("mouseenter", function(a){ return function(){clearTimeout(a.timer2)};}(menu) );
        }
        
        function menuOn( menu ) {
            var divs = menu.getElementsByTagName("div");
            if(nav_list) navOff();
            divs[1].className = "on";
            divs[0].className = "menuButton pushed";
            menu.active = true;
        }
        function menuOff( menu ) {
            var divs = menu.getElementsByTagName("div");
            divs[1].className = "off";
            divs[0].className = "menuButton";
            menu.active = false;
        }
        
        function thisMenuOnly(menu_id) {
            var menu = document.getElementById(menu_id);
            for( var i=0; i<menus.length; i++ )
                if( i!=menu_id )
                    menuOff( menus[i] );
            menuOn( menu );
        }
        
        function toggleMenu(menu_id) {
            var menu = document.getElementById(menu_id);
            if( menu.active ) {
                menuOff( menu );
            } else {
                for( var i=0; i<menus.length; i++ )
                    if( i!=menu_id )
                        menuOff( menus[i] );
                menuOn( menu );
            }
        }
        
        function openSearch() {
            for( var i=0; i<menus.length; i++ ) {
                menuOff( menus[i] );
                menus[i].style.zIndex = "-1";
            }
            searchicon.style.display = "none";
            closesearchicon.style.display = "block";
            searchbox.style.display = "block";
            searchinput.focus();
        }
        
        function closeSearch() {
            searchicon.style.display = "block";
            closesearchicon.style.display = "none";
            searchbox .style.display = "none";
            for( var i=0; i<menus.length; i++ )
                menus[i].style.zIndex = "0";
        }
        
        
        var documentDiv = document.getElementsByClassName("document")[0];
        documentDiv.addEventListener('click', function (event) {
            if(nav_list) navOff();
            for( var i=0; i<menus.length; i++ )
                menuOff( menus[i] );
        });
    </script>
  </body>
</html>